package measure

import (
	"time"
	"sort"
)

type TempMeasurement struct {
	Timestamp	time.Time
	Measurement float64
	}

func MakeSample() []TempMeasurement{

	measurements := []TempMeasurement{}
	currentMeasure := TempMeasurement{}
	now := time.Now()

	i := 1
	for i <= 240 {
	if (i < 120) {
		currentMeasure = TempMeasurement{Timestamp: now.Add(time.Second * time.Duration(-i)), Measurement: 100}
	} else {
		currentMeasure = TempMeasurement{Timestamp: now.Add(time.Second * time.Duration(-i)), Measurement: 200}
	}

	measurements = append(measurements, currentMeasure)
	i = i + 1
	}

	return measurements

}



func AvgTemp(measurements []TempMeasurement) float64 {
	timeLimit := time.Minute * time.Duration(-2)
	z := 0
	mCount  := float64(z)
	tempSum := 0.00
	avgTemp := 0.00

  // Sort the slice so that correct number of measurements can be averaged
	sort.Slice(measurements, func(x, y int) bool {
		return measurements[x].Timestamp.After(measurements[y].Timestamp)
	})


	for z < len(measurements) {
	if(measurements[z].Timestamp.Before(measurements[0].Timestamp.Add(timeLimit))) {
				p("Stop Index: ", z)
				p("Most Recent time is: ", measurements[0])
				p("Last Measurement in window: ", measurements[z])
				mCount = float64(z)
				avgTemp = (tempSum-measurements[z].Measurement)/mCount
				break
		}
		tempSum = tempSum + measurements[z].Measurement
	 z = z + 1
	}

	return avgTemp

}

